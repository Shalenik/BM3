<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Fitting BFACT to Real Climate Data • BFACT</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Fitting BFACT to Real Climate Data">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">BFACT</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/01-fit-real-data.html">Fitting BFACT to Real Climate Data</a></li>
    <li><a class="dropdown-item" href="../articles/02-posterior-simulation.html">Generate Posterior Simulations</a></li>
    <li><a class="dropdown-item" href="../articles/03-multiple-replicates.html">Model Selection Across Multiple Replications</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/shalenik/BM3/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Fitting BFACT to Real Climate Data</h1>
                        <h4 data-toc-skip class="author">BFACT
Package</h4>
            
            <h4 data-toc-skip class="date">2026-02-22</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/shalenik/BM3/blob/HEAD/vignettes/01-fit-real-data.Rmd" class="external-link"><code>vignettes/01-fit-real-data.Rmd</code></a></small>
      <div class="d-none name"><code>01-fit-real-data.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="fitting-bfact-to-real-climate-data">Fitting BFACT to Real Climate Data<a class="anchor" aria-label="anchor" href="#fitting-bfact-to-real-climate-data"></a>
</h2>
<p>This vignette demonstrates the complete workflow for fitting the
BFACT model to real climate data, using New York temperature anomalies
as an example.</p>
<div class="section level3">
<h3 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h3>
<p>The BFACT package includes real climate data from: - <strong>Climate
Models</strong>: Temperature anomalies from CMIP6 models for 3 SSP
scenarios (1850-2100) - <strong>Observations</strong>: HadCRUT5 annual
temperature anomalies (1850-2022) - <strong>Location</strong>: New York
region, summer (JJA) seasonal averages</p>
<p>This vignette demonstrates model fitting on a smaller scale.</p>
</div>
<div class="section level3">
<h3 id="load-real-climate-data">Load Real Climate Data<a class="anchor" aria-label="anchor" href="#load-real-climate-data"></a>
</h3>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://shalenik.github.io/BM3/">BFACT</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://cirrus.ucsd.edu/~pierce/ncdf/" class="external-link">ncdf4</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://patchwork.data-imaginist.com" class="external-link">patchwork</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Load NetCDF file containing New York temperature anomalies</span></span>
<span><span class="va">nc_file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"data"</span>, <span class="st">"NewYork_temperature_anomalies_JJA_all_models_1961-1990baseline.nc"</span>, package <span class="op">=</span> <span class="st">"BFACT"</span><span class="op">)</span></span>
<span><span class="va">nc_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ncdf4/man/nc_open.html" class="external-link">nc_open</a></span><span class="op">(</span><span class="va">nc_file</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Extract temperature data: dimensions are [lon, lat, year, scenario, model]</span></span>
<span><span class="va">temp_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ncdf4/man/ncvar_get.html" class="external-link">ncvar_get</a></span><span class="op">(</span><span class="va">nc_data</span>, <span class="st">"temperature"</span><span class="op">)</span></span>
<span><span class="va">years</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ncdf4/man/ncvar_get.html" class="external-link">ncvar_get</a></span><span class="op">(</span><span class="va">nc_data</span>, <span class="st">"year"</span><span class="op">)</span></span>
<span><span class="va">models</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ncdf4/man/ncvar_get.html" class="external-link">ncvar_get</a></span><span class="op">(</span><span class="va">nc_data</span>, <span class="st">"model"</span><span class="op">)</span></span>
<span><span class="co"># Spatially average across lon and lat for each year, scenario, and model</span></span>
<span><span class="co"># Result: [year, scenario, model] = [251, 3, 19]</span></span>
<span><span class="va">temp_avg</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">temp_data</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">4</span>, <span class="fl">5</span><span class="op">)</span>, <span class="va">mean</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Extract data for each SSP scenario</span></span>
<span><span class="co"># Scenarios: 1=SSP1-2.6, 2=SSP2-4.5, 3=SSP5-8.5</span></span>
<span><span class="va">climate_models</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    z126c <span class="op">=</span> <span class="va">temp_avg</span><span class="op">[</span>, <span class="fl">1</span>, <span class="op">]</span>,</span>
<span>    z245c <span class="op">=</span> <span class="va">temp_avg</span><span class="op">[</span>, <span class="fl">2</span>, <span class="op">]</span>,</span>
<span>    z585c <span class="op">=</span> <span class="va">temp_avg</span><span class="op">[</span>, <span class="fl">3</span>, <span class="op">]</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Add model names as column names</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">climate_models</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">climate_models</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">models</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Observations are available for years 1-173 (1850-2022)</span></span>
<span><span class="va">hadcrut_file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"data"</span>, <span class="st">"hadcrut5_annual.rds"</span>, package <span class="op">=</span> <span class="st">"BFACT"</span><span class="op">)</span></span>
<span><span class="va">hadcrut5_annual</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="va">hadcrut_file</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/ncdf4/man/nc_close.html" class="external-link">nc_close</a></span><span class="op">(</span><span class="va">nc_data</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Data summary</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Climate model dimensions:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">climate_models</span><span class="op">$</span><span class="va">z126c</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Climate model dimensions: 251 19</span></span></code></pre>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"HadCRUT5 observations:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">hadcrut5_annual</span><span class="op">)</span>, <span class="st">"years\n"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## HadCRUT5 observations: 173 years</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="visualize-data">Visualize Data<a class="anchor" aria-label="anchor" href="#visualize-data"></a>
</h3>
<p>Plot the climate models and observations to see what we’re working
with:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">1</span><span class="op">)</span>, mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">4</span>, <span class="fl">2</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">scenarios</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"z126c"</span>, <span class="st">"z245c"</span>, <span class="st">"z585c"</span><span class="op">)</span></span>
<span><span class="va">titles</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"SSP 1-2.6"</span>, <span class="st">"SSP 2-4.5"</span>, <span class="st">"SSP 5-8.5"</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">scenarios</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">mat</span> <span class="op">&lt;-</span> <span class="va">climate_models</span><span class="op">[[</span><span class="va">scenarios</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">]</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/graphics/matplot.html" class="external-link">matplot</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">mat</span><span class="op">)</span>, <span class="va">mat</span>,</span>
<span>        type <span class="op">=</span> <span class="st">"l"</span>, lty <span class="op">=</span> <span class="fl">1</span>, col <span class="op">=</span> <span class="st">"gray70"</span>,</span>
<span>        xlab <span class="op">=</span> <span class="st">"Year"</span>, ylab <span class="op">=</span> <span class="st">"Temperature Anomaly"</span>, main <span class="op">=</span> <span class="va">titles</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>,</span>
<span>        ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">mat</span>, <span class="va">hadcrut5_annual</span><span class="op">)</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>    <span class="co"># Add HadCRUT5 observations as red line for overlapping years</span></span>
<span>    <span class="va">n_hadcrut</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">hadcrut5_annual</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">n_hadcrut</span>, <span class="va">hadcrut5_annual</span>, col <span class="op">=</span> <span class="st">"red"</span>, lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"topright"</span>,</span>
<span>        legend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Climate Models"</span>, <span class="st">"HadCRUT5 Observations"</span><span class="op">)</span>,</span>
<span>        col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"gray70"</span>, <span class="st">"red"</span><span class="op">)</span>, lty <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>, cex <span class="op">=</span> <span class="fl">0.8</span>, bty <span class="op">=</span> <span class="st">"n"</span></span>
<span>    <span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p><img src="01-fit-real-data_files/figure-html/plot-data-1.png" class="r-plt" alt="" width="700"></p>
</div>
<div class="section level3">
<h3 id="prune-data-for-model-fitting">Prune Data for Model Fitting<a class="anchor" aria-label="anchor" href="#prune-data-for-model-fitting"></a>
</h3>
<p>There are two climate models that are clear outliers in all
scenarios. We apply an outlier detection method to identify and remove
these models before fitting the BFACT model. This step is performed
indpendently for each scenario.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Apply outlier detection to each scenario and prune</span></span>
<span><span class="va">pruned_climate_models</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">outlier_models</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">scenarios</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">mat</span> <span class="op">&lt;-</span> <span class="va">climate_models</span><span class="op">[[</span><span class="va">scenarios</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">]</span></span>
<span>    <span class="va">outlier_models</span><span class="op">[[</span><span class="va">scenarios</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu">BFACT</span><span class="fu">::</span><span class="fu"><a href="../reference/detect_outliers.html">detect_outliers</a></span><span class="op">(</span></span>
<span>        data <span class="op">=</span> <span class="va">mat</span>,</span>
<span>        start_index <span class="op">=</span> <span class="fl">1</span>,</span>
<span>        end_index <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">mat</span><span class="op">)</span>,</span>
<span>        threshold_fn <span class="op">=</span> <span class="fu">BFACT</span><span class="fu">::</span><span class="va"><a href="../reference/mean_sd_threshold.html">mean_sd_threshold</a></span>,</span>
<span>        threshold_dial <span class="op">=</span> <span class="fl">2.5</span></span>
<span>    <span class="op">)</span></span>
<span>    <span class="va">pruned_climate_models</span><span class="op">[[</span><span class="va">scenarios</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">mat</span><span class="op">[</span>, <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">mat</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">outlier_models</span><span class="op">[[</span><span class="va">scenarios</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">]</span>, drop <span class="op">=</span> <span class="cn">FALSE</span><span class="op">]</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Outliers by scenario:\n"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Outliers by scenario:</span></span></code></pre>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">outlier_models</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## $z126c</span></span>
<span><span class="co">## [1] "CIESM"       "UKESM1-0-LL"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $z245c</span></span>
<span><span class="co">## [1] "CIESM"       "UKESM1-0-LL"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $z585c</span></span>
<span><span class="co">## [1] "CIESM"       "UKESM1-0-LL"</span></span></code></pre>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Use pruned data for downstream fitting</span></span>
<span><span class="va">climate_models</span> <span class="op">&lt;-</span> <span class="va">pruned_climate_models</span></span>
<span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">scenarios</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">mat</span> <span class="op">&lt;-</span> <span class="va">climate_models</span><span class="op">[[</span><span class="va">scenarios</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">]</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/graphics/matplot.html" class="external-link">matplot</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">mat</span><span class="op">)</span>, <span class="va">mat</span>,</span>
<span>        type <span class="op">=</span> <span class="st">"l"</span>, lty <span class="op">=</span> <span class="fl">1</span>, col <span class="op">=</span> <span class="st">"gray70"</span>,</span>
<span>        xlab <span class="op">=</span> <span class="st">"Year"</span>, ylab <span class="op">=</span> <span class="st">"Temperature Anomaly"</span>, main <span class="op">=</span> <span class="va">titles</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>,</span>
<span>        ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">mat</span>, <span class="va">hadcrut5_annual</span><span class="op">)</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>    <span class="co"># Add HadCRUT5 observations as red line for overlapping years</span></span>
<span>    <span class="va">n_hadcrut</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">hadcrut5_annual</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">n_hadcrut</span>, <span class="va">hadcrut5_annual</span>, col <span class="op">=</span> <span class="st">"red"</span>, lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"topright"</span>,</span>
<span>        legend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Climate Models"</span>, <span class="st">"HadCRUT5 Observations"</span><span class="op">)</span>,</span>
<span>        col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"gray70"</span>, <span class="st">"red"</span><span class="op">)</span>, lty <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>, cex <span class="op">=</span> <span class="fl">0.8</span>, bty <span class="op">=</span> <span class="st">"n"</span></span>
<span>    <span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p><img src="01-fit-real-data_files/figure-html/prune-data-1.png" class="r-plt" alt="" width="700"><img src="01-fit-real-data_files/figure-html/prune-data-2.png" class="r-plt" alt="" width="700"><img src="01-fit-real-data_files/figure-html/prune-data-3.png" class="r-plt" alt="" width="700"></p>
</div>
<div class="section level3">
<h3 id="fit-bfact-models">Fit BFACT Models<a class="anchor" aria-label="anchor" href="#fit-bfact-models"></a>
</h3>
<p>Fit the BFACT model for each SSP scenario. This demonstration uses
100 MCMC iterations for speed; the full analysis in the paper uses 10000
iterations. Here we fit just H=2 for simplicity.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Fit BFACT for each SSP scenario</span></span>
<span><span class="co"># Note: Using reduced parameters for demonstration</span></span>
<span><span class="co"># Paper uses: H=2:7, nsim=10000</span></span>
<span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">scenarios</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"\n=== Fitting %s ===\n"</span>, <span class="va">titles</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>    <span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/BFACT.html">BFACT</a></span><span class="op">(</span></span>
<span>        Y <span class="op">=</span> <span class="va">climate_models</span><span class="op">[[</span><span class="va">scenarios</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">]</span>,</span>
<span>        z <span class="op">=</span> <span class="va">hadcrut5_annual</span>,</span>
<span>        T <span class="op">=</span> <span class="fl">251</span>, <span class="co"># Total time points</span></span>
<span>        T1 <span class="op">=</span> <span class="fl">1</span>, <span class="co"># Start of climate model data</span></span>
<span>        T2 <span class="op">=</span> <span class="fl">173</span>, <span class="co"># End of observation data</span></span>
<span>        H <span class="op">=</span> <span class="fl">2</span>, <span class="co"># Basis dimension (paper fits 2:7)</span></span>
<span>        iseed <span class="op">=</span> <span class="fl">123</span> <span class="op">+</span> <span class="va">i</span>, <span class="co"># Different seed for each scenario</span></span>
<span>        J <span class="op">=</span> <span class="fl">6</span>, <span class="co"># Burnin iterations</span></span>
<span>        nsim <span class="op">=</span> <span class="fl">100</span> <span class="co"># MCMC iterations (paper uses 10000)</span></span>
<span>    <span class="op">)</span></span>
<span>    <span class="va">results</span><span class="op">[[</span><span class="va">scenarios</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">fit</span></span>
<span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"Completed fit for %s\n"</span>, <span class="va">titles</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## === Fitting SSP 1-2.6 ===</span></span>
<span><span class="co">## Completed fit for SSP 1-2.6</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## === Fitting SSP 2-4.5 ===</span></span>
<span><span class="co">## Completed fit for SSP 2-4.5</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## === Fitting SSP 5-8.5 ===</span></span>
<span><span class="co">## Completed fit for SSP 5-8.5</span></span></code></pre>
<ul>
<li>
<code>nsim</code>: Number of MCMC iterations (100 here for speed,
10000 in the paper)</li>
<li>
<code>J</code>: Burnin iterations</li>
<li>
<code>H</code>: Basis functions (2-7 in full analysis)</li>
<li>Each fit at H=2 with 100 iterations takes ~1-2 seconds</li>
</ul>
</div>
<div class="section level3">
<h3 id="visualize-posterior-results">Visualize Posterior Results<a class="anchor" aria-label="anchor" href="#visualize-posterior-results"></a>
</h3>
<p>Plot the posterior samples against the observations and models:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Generate plots for each scenario</span></span>
<span><span class="va">plots</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">scenarios</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="co"># Get posterior samples</span></span>
<span>    <span class="va">fit</span> <span class="op">&lt;-</span> <span class="va">results</span><span class="op">[[</span><span class="va">scenarios</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">]</span></span>
<span>    <span class="va">burn_start</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">ceiling</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">fit</span><span class="op">$</span><span class="va">beta_samples</span><span class="op">)</span> <span class="op">/</span> <span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span>    <span class="co"># Compute posterior means for each sample</span></span>
<span>    <span class="va">post_samples</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sample_posterior.html">sample_posterior</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span>
<span></span>
<span>    <span class="co"># Create plot using the new function</span></span>
<span>    <span class="va">plots</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/plot_data_with_posterior.html">plot_data_with_posterior</a></span><span class="op">(</span></span>
<span>        Y <span class="op">=</span> <span class="va">climate_models</span><span class="op">[[</span><span class="va">scenarios</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">]</span>,</span>
<span>        z <span class="op">=</span> <span class="va">hadcrut5_annual</span>,</span>
<span>        posterior_samples <span class="op">=</span> <span class="va">post_samples</span>,</span>
<span>        title <span class="op">=</span> <span class="va">titles</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>,</span>
<span>        years <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">251</span>,</span>
<span>        obs_years <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">173</span></span>
<span>    <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Combine plots with patchwork</span></span>
<span><span class="va">combined_plot</span> <span class="op">&lt;-</span> <span class="va">plots</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op">/</span> <span class="va">plots</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span> <span class="op">/</span> <span class="va">plots</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">combined_plot</span><span class="op">)</span></span></code></pre></div>
<p><img src="01-fit-real-data_files/figure-html/plot-results-1.png" class="r-plt" alt="" width="700"></p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Shaleni Kovach.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
